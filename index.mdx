import { CodeSurfer, CodeSurferColumns,Step} from 'code-surfer';
import { Figure, Footnotes, GithubInfo, Stackblitz, Quote, Title } from './mdx-components/index';
import { theme as customTheme } from './theme';

export const theme = customTheme;

import basket1 from './images/basket-1.png';
import basket2 from './images/basket-2.png';
import basket3 from './images/basket-3.png';


<Title>JavaScript state management</Title>

---

# What is it?

<Quote author="Raquel Moss" url="https://egghead.io/articles/what-is-state-why-do-i-need-to-manage-it">
State management makes the <strong>state of your app</strong> tangible in the form of a <strong>data structure</strong> that you can read from and write to. It makes your ‘invisible’ state clearly visible for you <strong>to work</strong> with.
</Quote>

---

# Why would i need it?

<img src={basket1} style={{width:'300px'}}/>

---

# Why would i need it?

<img src={basket2} style={{width:'300px'}}/>

---

# Why would i need it?

<img src={basket3} style={{width:'300px'}}/>

---

# When do I need it?

- UI **components** that have dependencies (shared state)
- Creating (complex) web applications architectures
- **SPAs/PWAs** (React, Vue, Angular, ...)
- **mobile** apps (React Native, Flutter, ...)

---

# So basically always?

No. Don't overengineer simple applications.

---

# Flux (2014)

- pattern by Facebook
- client-side web applications
- answer to two-way data binding (AngularJS)
- unidirectional data flow
- reactive programming, data-flow programming
- no direct data mutation, mutations are described as actions
- ≠ MVC

<Footnotes>
    <a href="https://facebook.github.io/flux/">https://facebook.github.io/flux/</a>
</Footnotes>

---

<Figure src="https://facebook.github.io/flux/img/overview/flux-simple-f8-diagram-1300w.png" alt="Basic Flux Structure">
    <a href="https://facebook.github.io/flux/docs/in-depth-overview">https://facebook.github.io/flux/docs/in-depth-overview</a>
</Figure>


- **Actions**: Contain data and type information
- **Dispatchers**: Dispatch the actions
- **Stores**: Contain the state
- **Views**: Re-render if the stores update

---

<Figure src="https://facebook.github.io/flux/img/overview/flux-simple-f8-diagram-explained-1300w.png" alt="Detailed Flux flow">
    <a href="https://facebook.github.io/flux/docs/in-depth-overview">https://facebook.github.io/flux/docs/in-depth-overview</a>
</Figure>

---

## Basic principle

```js
(state, action) => new state
```
---

# Redux (2015)

Three principles
- Single source of truth (= one store)
- State is read-only (= only way to change by emitting actions)
- Changes are made with pure functions (pure reducers)

<Footnotes>
    <ul>
        <li><a href="https://redux.js.org/introduction/three-principles">https://redux.js.org/introduction/three-principles</a></li>
        <li><a href="https://www.freecodecamp.org/news/redux-in-24-lines-of-code/">https://www.freecodecamp.org/news/redux-in-24-lines-of-code/</a></li>
        <li><a href="https://www.robinwieruch.de/redux-javascript">https://www.robinwieruch.de/redux-javascript</a></li>
    </ul>
</Footnotes>

---

<Figure src="https://codingthesmartway.com/wp-content/uploads/2017/05/01.png" alt="Redux flow">
    <a href="https://codingthesmartway.com/wp-content/uploads/2017/05/01.png">https://codingthesmartway.com/wp-content/uploads/2017/05/01.png</a>
</Figure>

---

## React + Redux

<GithubInfo repo="reduxjs/redux"></GithubInfo>

---

<Stackblitz id="uum-react-redux-example"></Stackblitz>

---

<CodeSurfer>

```js 5:7 file=./redux-react/store.js title="Store" 
```

```js 1:3 file=./redux-react/actions.js title="Actions" 
```

```js 1:3,5:17 file=./redux-react/actions.js title="Actions" 
```

```js 1:6 file=./redux-react/reducers.js title="Reducers" 
```

```js 7:30 file=./redux-react/reducers.js title="Reducers" 
```

```js 11:18 file=./redux-react/App.jsx title="React integration" 
```

```js 22:33 file=./redux-react/App.jsx title="React integration" 
```

```js 9,14,24 file=./redux-react/App.jsx title="Selectors" 
```

</CodeSurfer>

---

### Selectors

<Quote author="Matthew Holman" url="https://medium.com/@matthew.holman/what-is-a-redux-selector-a517acee1fe8">
    A “selector” is <strong>simply a function</strong> that accepts Redux <strong>state</strong> as an argument and <strong>returns data</strong> that is derived from that state.
</Quote>

---

## Basic selector principle

```js
(state) => state.something
```

---

## React + Redux

### Additional

* Asynchronous "actions" and side effects [redux-thunk](https://github.com/reduxjs/redux-thunk)
* Selectors Memoization [reselect](https://github.com/reduxjs/reselect)
* Redux alternative with less boilerplate [rematch](https://github.com/rematch/rematch)
* Redux style guide (https://redux.js.org/style-guide/style-guide)
* Redux dev tools (https://github.com/reduxjs/redux-devtools)

---

## Vue + Vuex (2016)

<GithubInfo repo="vuejs/vuex"></GithubInfo>

---

<Figure src="https://vuex.vuejs.org/vuex.png" alt="Vuex architecture">
    <a href="https://vuex.vuejs.org/vuex.png">https://vuex.vuejs.org/vuex.png</a>
</Figure>

---

<Stackblitz id="uum-vue-vuex-example"></Stackblitz>

---

<CodeSurfer>

```js 1,5:8,25 file=./vue-vuex/store.js title="Store" 
```

```js 9:19 file=./vue-vuex/store.js title="Mutations" 
```

```js 20:24 file=./vue-vuex/store.js title="Getters" 
```

```js 9:13 file=./vue-vuex/index.js title="Vue integration - store" 
```

```js 15,17:23,37:38 file=./vue-vuex/index.js title="Vue integration - state" 
```

```js 15:16,39 file=./vue-vuex/index.js title="Vue integration - getters" 
```

```js 24:34,40:42 file=./vue-vuex/index.js title="Vue integration - mutations" 
```

</CodeSurfer>

---

## Angular + NgRx (2017)

<GithubInfo repo="ngrx/platform"></GithubInfo>

---


<Figure src="https://ngrx.io/generated/images/guide/store/state-management-lifecycle.png" alt="NgRx lifecycle">
    <a href="https://ngrx.io/generated/images/guide/store/state-management-lifecycle.png">https://ngrx.io/generated/images/guide/store/state-management-lifecycle.png</a>
</Figure>

---

<Stackblitz id="uum-angular-ngrx-example"></Stackblitz>

---

<CodeSurfer>

```js 4:6,8:9,19 file=./angular-ngrx/reducer.ts title="Store/Reducer" 
```

```js 10:18 file=./angular-ngrx/reducer.ts title="Store/Reducer" 
```

```js file=./angular-ngrx/actions.ts title="Actions" 
```

```js file=./angular-ngrx/selectors.ts title="Selectors" 
```

```js 8:12,17,34 file=./angular-ngrx/app.component.ts title="Angular integration store" 
```

```js 6,13:15,18:20 file=./angular-ngrx/app.component.ts title="Angular integration selectors" 
```

```js 5,23:33 file=./angular-ngrx/app.component.ts title="Angular integration actions" 
```

```js file=./angular-ngrx/app.component.html title="Angular integration actions" 
```

</CodeSurfer>

---


## Comparison

|                                     | Redux    | Vuex     | NgRx     |
| ----------------------------------  | -------- | -------- | -------- |
| Update (synchronous)                | Action   | Mutation | Action   | 
| Update (asynchronous)               | Thunk    | Action   | Effect   |
| Trigger updates (synchronous)       | Dispatch | Commit   | Dispatch |
| Trigger updates (asynchronous)      | Dispatch | Dispatch | Dispatch |
| Compute derived data                | Selector | Getter   | Selector |


---

# NGXS (2018)

<GithubInfo repo="ngxs/store"></GithubInfo>

<Quote url="https://www.ngxs.io/">
NGXS is modeled after the <strong>CQRS pattern</strong> popularly implemented in libraries like Redux and NgRx but <strong>reduces boilerplate</strong> by using modern TypeScript features such as classes and decorators.
</Quote>


---

## NGXS Immer Example

<Stackblitz id="angular-ngxs-immer-tryout"></Stackblitz>

---

# MobX (2017)

<GithubInfo repo="mobxjs/mobx"></GithubInfo>

---

## MobX - React Example

<GithubInfo repo="mhlzr/react-mobx-card-game"></GithubInfo>

https://react-mobx-card-game.now.sh

---

# React Hooks & Context API (2019 officially)

https://reactjs.org/docs/hooks-intro.html
https://dev.to/gloriamaris/implementing-state-management-using-context-api-and-hooks-in-react-36jk
https://github.com/facebookincubator/redux-react-hook

---

# Hyperapp

<GithubInfo repo="jorgebucaran/hyperapp"></GithubInfo>

---

# Svelte

<GithubInfo repo="sveltejs/svelte"></GithubInfo>

---

# Conclusion

It depends ;)

Redux etc. not always required, alternatives

---