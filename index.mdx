import { CodeSurfer, CodeSurferColumns,Step} from 'code-surfer';
import { Figure, Footnotes, Stackblitz, Quote, Title } from './mdx-components/index';
import { theme as customTheme } from './theme';
export const theme = customTheme;

<Title>JavaScript state management</Title>

---

# What is it?

<Quote author="Raquel Moss" url="https://egghead.io/articles/what-is-state-why-do-i-need-to-manage-it">
State management makes the <strong>state of your app</strong> tangible in the form of a <strong>data structure</strong> that you can read from and write to. It makes your ‘invisible’ state clearly visible for you <strong>to work</strong> with.
</Quote>

---

# When do I need it?

- UI **components** that have dependencies (shared state)
- **SPAs/PWAs** (React, Vue, Angular, ...)
- **mobile** apps (React Native, Flutter, ...)


---

# Flux (2014)

- pattern by Facebook
- client-side web applications
- answer to two-way data binding (AngularJS)
- unidirectional data flow
- reactive programming, data-flow programming
- no direct data mutation, mutations are described as actions
- ≠ MVC

<Footnotes>
    <a href="https://facebook.github.io/flux/">https://facebook.github.io/flux/</a>
</Footnotes>

---

<Figure src="https://facebook.github.io/flux/img/overview/flux-simple-f8-diagram-1300w.png" alt="Basic Flux Structure">
    <a href="https://facebook.github.io/flux/docs/in-depth-overview">https://facebook.github.io/flux/docs/in-depth-overview</a>
</Figure>


- **Actions**: Contain data and type information
- **Dispatchers**: Dispatch the actions
- **Stores**: Contain the state
- **Views**: Re-render if the stores update

---

<Figure src="https://facebook.github.io/flux/img/overview/flux-simple-f8-diagram-explained-1300w.png" alt="Detailed Flux flow">
    <a href="https://facebook.github.io/flux/docs/in-depth-overview">https://facebook.github.io/flux/docs/in-depth-overview</a>
</Figure>

---

## Basic principle

```javascript
(state, action) => state
```

<Footnotes>
    <a href="https://speakerdeck.com/jmorrell/jsconf-uy-flux-those-who-forget-the-past-dot-dot-dot-1?slide=40">https://speakerdeck.com/jmorrell/jsconf-uy-flux-those-who-forget-the-past-dot-dot-dot-1?slide=40</a>
</Footnotes>

---

# Redux (2015)

Event Sourcing

Three principles
- Single source of truth (= one store)
- State is read-only (= only way to change by emitting actions)
- Changes are made with pure functions (pure reducers)

<Footnotes>
    <ul>
        <li><a href="https://redux.js.org/">https://redux.js.org</a></li>
        <li><a href="https://redux.js.org/introduction/three-principles">https://redux.js.org/introduction/three-principles</a></li>
    </ul>
</Footnotes>

---

<Figure src="https://miro.medium.com/max/1572/1*f0yed8d3cHXd615cV1oBKw.png" alt="Redux flow">
    <a href="https://medium.com/@jdc91xt/the-redux-crash-course-7759b09500fa">https://medium.com/@jdc91xt/the-redux-crash-course-7759b09500fa</a>
</Figure>

---

## React + Redux

<Stackblitz id="uum-react-redux-example"></Stackblitz>

---

<CodeSurfer>

  ```js 1:5 file=./redux-react/store.js title="Store" 
  ```

</CodeSurfer>

---

### Action

---

### Reducer

---

### Selector

https://medium.com/@matthew.holman/what-is-a-redux-selector-a517acee1fe8

---

## React + Redux

Pros / Cons

- verbose/boilerplate code

https://react-redux.js.org/
https://github.com/reduxjs/redux-thunk
https://github.com/reduxjs/reselect (Memoization)
https://github.com/rematch/rematch

---

## Vue + Vuex (2016)

<Figure src="https://vuex.vuejs.org/vuex.png" alt="Vuex architecture">
    <a href="https://vuex.vuejs.org/vuex.png">https://vuex.vuejs.org/vuex.png</a>
</Figure>

<Footnotes>
    <a href="https://vuex.vuejs.org">https://vuex.vuejs.org</a>
</Footnotes>



---

### Store

---

### Mutations

---

### Actions

---

### Getters

---

## Angular + NgRx (2017)

<Figure src="https://ngrx.io/generated/images/guide/store/state-management-lifecycle.png" alt="NgRx lifecycle">
    <a href="https://ngrx.io/generated/images/guide/store/state-management-lifecycle.png">https://ngrx.io/generated/images/guide/store/state-management-lifecycle.png</a>
</Figure>

<Footnotes>
    <a href="https://ngrx.io/">https://ngrx.io/</a>
</Footnotes>

---

<Stackblitz id="uum-angular-ngrx-example"></Stackblitz>

---

### Store

---

### Actions

---

### Reducers

---

### Selectors

---

## Comparison

|                                     | Redux    | Vuex     | NgRx     |
| ----------------------------------  | -------- | -------- | -------- |
| Update (synchronous)                | Action   | Mutation | Action   | 
| Update (asynchronous)               | Thunk    | Action   | Effect   |
| Trigger updates (synchronous)       | Dispatch | Commit   | Dispatch |
| Trigger updates (asynchronous)      | Dispatch | Dispatch | Dispatch |
| Compute derived data                | Selector | Getter   | Selector |

Store
Reducer
Selectors
Effects



---

## NGXS (2018)

https://www.ngxs.io/

---

# MobX (2017)

https://github.com/mobxjs/mobx

---

# React Hooks & Context API (2019 officially)

https://reactjs.org/docs/hooks-intro.html
https://dev.to/gloriamaris/implementing-state-management-using-context-api-and-hooks-in-react-36jk

---

# Hyperapp

---

# Svelte

---

# Conclusion

It depends ;)

Redux etc. not always required, alternatives

---